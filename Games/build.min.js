function revealEvent(a){return Rx.Observable.fromEventPattern(function(b){return Reveal.addEventListener(a,b)},function(b){return Reveal.removeEventListener(a,b)})}function toArray(){return Array.prototype.slice.call(arguments[0])}function snakelet(a,b,c){return void 0===c&&(c=5),Array.apply(null,{length:c}).map(function(c){return new Point2D(a,b)})}function draw(a,b){if(a.clearRect(0,0,a.canvas.width,a.canvas.height),b.snake.forEach(function(b){a.beginPath(),a.arc(b.x*diameter+diameter/2,b.y*diameter+diameter/2,diameter*b.size/2,0,2*Math.PI,!1),a.fillStyle="green",a.fill()}),b.candy.forEach(function(c){a.beginPath(),1==b.candy.length?a.arc(c.x*diameter+diameter/2,c.y*diameter+diameter/2,diameter/2,0,2*Math.PI,!1):a.rect(c.x*diameter,c.y*diameter,diameter,diameter),a.fillStyle="orange",a.fill()}),0==b.status){var c,d;a.font="40px Arial",c="Press any arrow/wasd key",d=a.measureText(c),a.fillText(c,screenW/2-d.width/2,screenH/2),c="to move",d=a.measureText(c),a.fillText(c,screenW/2-d.width/2,screenH/2+60)}if(2==b.status){a.font="60px Arial";var d=a.measureText("GAME OVER");a.fillText("GAME OVER",screenW/2-d.width/2,screenH/2-30),a.font="40px Arial";var d=a.measureText("Press enter to restart");a.fillText("Press enter to restart",screenW/2-d.width/2,screenH/2+20)}}function eat(a,b,c){return b.map(function(b){return a.snake[0].equals(b)}).filter(function(a){return a}).length?(c.onNext(0),new State([a.snake[0].belly()].concat(a.snake.slice(1).concat(afill(b.length,function(b){return a.snake[a.snake.length-1]}))),[],a.status)):new State(a.snake,b,a.status)}function move(a,b){if(1==a.status||0==a.status&&0!=b.length){var c=a.snake[0].move(b).loopRound(screenW/diameter,screenH/diameter);return a.snake.slice(0,-1).reduce(function(a,b){return a||c.equals(b)},!1)?new State(a.snake,a.candy,2):new State([c].concat(a.snake.slice(0,-1)),a.candy,1)}return a}function toDirection(a){switch(a){case KeyCodes.w:case 38:return[0,-1];case KeyCodes.s:case 40:return[0,1];case KeyCodes.a:case 37:return[-1,0];case KeyCodes.d:case 39:return[1,0];default:return[]}}function Monster(a){var b=Math.ceil(Math.sqrt(a));return afill(a,function(a){return 1}).concat(afill(b*b-a,function(a){return 0})).sort(function(a){return Math.random()-.5>0}).map(function(a,c){return a?new Point2D(~~(c/b),c%b):null}).filter(function(a){return!!a})}function afill(a,b){return Array.apply(null,new Array(a)).map(function(a,c){return b(c)})}var __extends=this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},math;!function(a){var b=function(){function a(a){void 0===a&&(a=123456789),this.m_w=123456789,this.m_z=987654321,this.mask=4294967295,this.m_w=a}return a.prototype.random=function(){this.m_z=36969*(65535&this.m_z)+(this.m_z>>16)&this.mask,this.m_w=18e3*(65535&this.m_w)+(this.m_w>>16)&this.mask;var a=(this.m_z<<16)+this.m_w&this.mask;return a/=4294967296,a+.5},a}();a.RNG=b;var c=function(){function a(a,b){this.x=a,this.y=b}return a.prototype.add=function(b){return new a(this.x+b.x,this.y+b.y)},a.prototype.min=function(b){return new a(this.x-b.x,this.y-b.y)},a.prototype.rotate=function(b,c){void 0===c&&(c=null);var d=null==c?this:this.min(c),e=Math.sin(b),f=Math.cos(b),g=new a(d.x*f-d.y*e,d.x*e+d.y*f);return null==c?g:c.add(g)},a.prototype.size=function(){return Math.sqrt(this.x*this.x+this.y*this.y)},a.prototype.times=function(b){return new a(this.x*b,this.y*b)},a.prototype.toString=function(){return"("+this.x+","+this.y+")"},a.prototype.map=function(b,c){return new a(b(this.x),c(this.y))},a.prototype.equals=function(a){return this.x===a.x&&this.y===a.y},a}();a.Point2D=c;var d=function(){function a(a,b){this._0=a,this._1=b,this.a=0,this.b=0,this.a=(b.y-a.y)/(b.x-a.x),this.b=a.y-this.a*a.x}return a.prototype.intersects=function(b){if(this.a===b.a)return[];if(isFinite(this.a)&&isFinite(b.a)){var d=(this.b-b.b)/(b.a-this.a),e=a.getLineIntersection(this._0.x,this._0.y,this._1.x,this._1.y,b._0.x,b._0.y,b._1.x,b._1.y);return e&&[new c(d,d*this.a+this.b)]||[]}var f=[[this,b],[b,this]].filter(function(a){return!isFinite(a[0].a)}).reduce(function(b,d){var e=d[1].a*d[0]._0.x+d[1].b;return b.length&&b||a.surround(d[0]._0.x,d[1]._0.x,d[1]._1.x)&&a.surround(e,d[0]._0.y,d[0]._1.y)&&[new c(d[0]._0.x,e)]},[]);return f},a.surround=function(a,b,c){return a<Math.max(b,c)&&a>Math.min(b,c)},a.prototype.draw=function(a,b){void 0===b&&(b=!1),a.beginPath(),a.moveTo(this._0.x,a.canvas.height-this._0.y),a.lineTo(this._1.x,a.canvas.height-this._1.y),a.stroke()},a.prototype.extended=function(b,d){return new a(new c(b,this.a*b+this.b),new c(d,this.a*d+this.b))},a.getLineIntersection=function(a,b,c,d,e,f,g,h){var i,j,k,l;i=c-a,j=d-b,k=g-e,l=h-f;var m,n;if(m=(-j*(a-e)+i*(b-f))/(-k*j+i*l),n=(k*(b-f)-l*(a-e))/(-k*j+i*l),m>=0&&1>=m&&n>=0&&1>=n){var o=a+n*i,p=b+n*j;return[o,p]}return null},a.prototype.size=function(){return Math.sqrt(Math.pow(this._1.x-this._0.x,2)+Math.pow(this._1.y-this._0.y,2))},a}();a.Line2D=d;var e=function(){function a(a,b){this.centre=a,this.points=b}return a.prototype.rotate=function(b){var c=this;return new a(this.centre,this.points.map(function(a){return a.rotate(b,c.centre)}))},a.prototype.move=function(b){return new a(this.centre.add(b),this.points.map(function(a){return a.add(b)}))},a}(),f=function(a){function b(b,d,e,f){void 0===f&&(f=[]),a.call(this,b,f),this.centre=b,this.width=d,this.height=e,this.points=f,this.rotation=0,this.points=f.length&&f||[[-.5,-.5],[.5,-.5],[.5,.5],[-.5,.5]].map(function(a){return b.add(new c(a[0]*d,a[1]*e))})}return __extends(b,a),b.prototype.move=function(a){return new b(this.centre.add(a),this.width,this.height,this.points.map(function(b){return b.add(a)}))},b.prototype.rotate=function(c){var d=new b(this.centre,this.width,this.height);return d.rotation=this.rotation+c,d.points=a.prototype.rotate.call(this,c).points,d},b.prototype.draw=function(a,b,c){void 0===b&&(b=!1),void 0===c&&(c=!0),a.beginPath(),a.moveTo(this.points[0].x,c?a.canvas.height-this.points[0].y:this.points[0].y);for(var d=1;d<this.points.length;d++)a.lineTo(this.points[d].x,c?a.canvas.height-this.points[d].y:this.points[d].y);if(a.closePath(),a.fill(),b){var e=a.strokeStyle;a.strokeStyle="red",this.lines().forEach(function(b){return b.draw(a)}),a.strokeStyle=e}},b.prototype.map=function(a,c){var d=new b(this.centre.map(a,c),0,0);return d.points=this.points.map(function(b){return b.map(a,c)}),d},b.prototype.clearRadius=function(){return Math.max(this.width,this.height)},b.prototype.lines=function(){var a=this;return this.points.map(function(b,c){return new d(b,a.points[(c+1)%a.points.length])})},b.prototype.intersects=function(a){return this.centre.min(a.centre).size()<Math.min(this.clearRadius(),a.clearRadius())},b}(e);a.Box=f}(math||(math={})),Reveal.onSlideChanged=revealEvent("slidechanged"),Reveal.onReady=revealEvent("ready"),Reveal.forSlide=function(a,b){return Rx.Observable.merge(Reveal.onReady,Reveal.onSlideChanged).distinctUntilChanged(function(b){return a(b)}).filter(a).flatMap(function(c){return b(c).takeUntil(Reveal.onSlideChanged.filter(function(b){return!a(b)}))})},Reveal.addEventListener("ready",function(a){}),Rx.Observable.prototype.flatScan=function(a,b){var c=this;return Rx.Observable.create(function(d){function e(a){i.remove(a),0==i.length&&d.onCompleted()}function f(a,b){var c=new Rx.SingleAssignmentDisposable;i.add(c),c.current=a.subscribe(b,d.onError,function(){return e(c)})}function g(a,b){var c=new Rx.SingleAssignmentDisposable;i.add(c),c.current=a.subscribe(b,d.onError,function(){return e(c)})}function h(c){f(a(c),function(a){d.onNext(a),g(b(a),h)})}var i=new Rx.CompositeDisposable;return f(c,h),i})};var Rx;!function(a){var b=(a.Observable,a.Observer.create,a.Disposable.create),c=a.CompositeDisposable,d=a.SingleAssignmentDisposable,e=(a.AsyncSubject,a.Subject,a.Scheduler),f=function(){return Date.now?Date.now:function(){return+new Date}}();!function(g){var h,i;g.requestAnimationFrame?(h=g.requestAnimationFrame,i=g.cancelAnimationFrame):g.mozRequestAnimationFrame?(h=g.mozRequestAnimationFrame,i=g.mozCancelAnimationFrame):g.webkitRequestAnimationFrame?(h=g.webkitRequestAnimationFrame,i=g.webkitCancelAnimationFrame):g.msRequestAnimationFrame?(h=g.msRequestAnimationFrame,i=g.msCancelAnimationFrame):g.oRequestAnimationFrame?(h=g.oRequestAnimationFrame,i=g.oCancelAnimationFrame):(h=function(a){g.setTimeout(a,1e3/60)},i=g.clearTimeout),a.Scheduler.requestAnimationFrame=function(){function g(d,e){var f=this,g=new a.SingleAssignmentDisposable,j=h(function(){!g.isDisposed&&g.setDisposable(e(f,d))});return new c(g,b(function(){i(j)}))}function j(a,f,g){var j=this,k=e.normalize(f);if(0===k)return j.scheduleWithState(a,g);var l,m=new d,n=function(){l&&i(l),k-j.now()<=0?!m.isDisposed&&m.setDisposable(g(j,a)):l=h(n)};return l=h(n),new c(m,b(function(){i(l)}))}function k(a,b,c){return this.scheduleWithRelativeAndState(a,b-this.now(),c)}return new e(f,g,j,k)}()}(window)}(Rx||(Rx={})),Function.prototype.curry=function(){if(arguments.length<1)return this;var a=this,b=toArray.call(this,arguments);return function(){return a.apply(this,b.concat(toArray.call(this,arguments)))}};var AnonymousObservable=Rx.AnonymousObservable;Rx.Observable.prototype.sliding=function(a,b){var c=this;return new AnonymousObservable(function(d){var e=[];return c.subscribe(function(c){e.push(c),e.length==a&&(d.onNext(e),e=e.slice(b))},function(a){return d.onError(a)},function(){return d.onCompleted()})})},Rx.Observable.prototype.tupled=Rx.Observable.prototype.sliding.curry(2,1);var levels=[[new math.Box(new math.Point2D(300,15),30,30)],[new math.Box(new math.Point2D(170,15),30,30),new math.Box(new math.Point2D(340,15),30,30),new math.Box(new math.Point2D(510,15),30,30)],[new math.Box(new math.Point2D(100,15),30,30),new math.Box(new math.Point2D(220,35),30,30),new math.Box(new math.Point2D(340,15),30,30),new math.Box(new math.Point2D(460,35),30,30),new math.Box(new math.Point2D(580,15),30,30),new math.Box(new math.Point2D(700,35),30,30)]],BoxJump;!function(a){var b=function(){function b(a){this.ctx=a,this.level=0,this.spaces=$(window).onAsObservable("keydown keyup").filter(function(a){return 32===a.keyCode}).map(function(a){return"keydown"===a.type}),this.singlespace=this.spaces.take(1)}return b.prototype.run=function(){var b=this;this.level=0;var c=Rx.Observable.interval(1e3/30,Rx.Scheduler.requestAnimationFrame).startWith(0).map(function(a){return(new Date).getTime()}).tupled().map(function(a){return a[1]-a[0]}).withLatestFrom(this.spaces.startWith(!1),function(a,b){return{time:a,space:b}}).scan(new a.Player(new math.Box(new math.Point2D(0,0),20,20),null),function(a,b){return a.update(b.time,b.space)}).takeWhile(function(a){return a.box.centre.x<b.ctx.canvas.width}).doWhile(function(){return++b.level<levels.length}).takeWhile(function(a){return b.level>=0}).tap(function(a){try{b.ctx.clearRect(0,0,b.ctx.canvas.width,b.ctx.canvas.height),b.ctx.fillStyle="rgba(255,0,0,1)",a.box.draw(b.ctx);var c=!1;if(levels[b.level])for(var d in levels[b.level])levels[b.level][d].draw(b.ctx),c=c||a.box.intersects(levels[b.level][d]);c&&(b.level=-1);var e="Level: "+b.level;b.ctx.font="12px Arial",b.ctx.fillText(e,b.ctx.canvas.width-b.ctx.measureText(e).width-10,15)}catch(f){console.error("Subscribe error! %s",f)}},function(a){return console.error(a)},function(){var a=b.level>0?"You WON!":"You LOST!";b.ctx.font="30px Arial",b.ctx.fillText(a,b.ctx.canvas.width/2-b.ctx.measureText(a).width/2,b.ctx.canvas.height/2)});return c.map(function(a){return 1}).concat(this.singlespace.map(function(a){return b.level=0,1})).repeat()},b}();a.Game=b;var c=function(){function a(a,b){this.box=a,this.velocity=b,null==this.velocity&&(this.velocity=new math.Point2D(170,0))}return a.prototype.jump=function(){return this.box.centre.y==this.box.height/2?new a(this.box,new math.Point2D(this.velocity.x,340)):this},a.prototype.rotate=function(){if(this.box.centre.y>this.box.height/2){var b=Math.max(this.velocity.y,-340)/340;return new a(new math.Box(this.box.centre,this.box.width,this.box.height).rotate(Math.PI/2*b),this.velocity)}return this},a.prototype.update=function(b,c){var d=this,e=new math.Point2D(this.velocity.x,this.box.centre.y<=0?0:this.velocity.y-30),f=this.velocity.times(b/1e3);f=this.box.centre.add(f).map(function(a){return a},function(a){return Math.max(a,d.box.height/2)}).min(this.box.centre);var g=new a(this.box.move(f),e);return c&&(g=g.jump()),g.rotate()},a}();a.Player=c}(BoxJump||(BoxJump={})),Reveal.forSlide(function(a){return $(a.currentSlide).closest("#g-boxjump").get().length>0},function(a){console.log("BoxJump");var b=$("#boxjump").get(0);return new BoxJump.Game(b.getContext("2d")).run()}).subscribe(function(a){});var Breakout;!function(a){var b=function(){function a(a,b){this.x=a,this.y=b,this.speed=120}return a.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.y),80,10)},a.prototype.update=function(b,c){return new a(this.x+b*c*this.speed,this.y)},a.prototype.draw=function(a){this.box().draw(a)},a.prototype.lines=function(){return this.box().lines()},a.initial=function(){return new a(400,55)},a}();a.Paddle=b;var c=function(){function a(a,b,c,d,e,f){void 0===e&&(e=null),void 0===f&&(f=1),this.x=a,this.y=b,this.width=c,this.height=d,this.color=e,this.health=f,null==this.color&&(this.color="rgb("+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+", "+Math.floor(255*Math.random())+")")}return a.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.y),this.width,this.height)},a.prototype.draw=function(a){a.save(),a.fillStyle=this.color,this.box().draw(a),a.restore()},a.prototype.lines=function(){return this.box().lines()},a.prototype.decreaseHealth=function(b){return void 0===b&&(b=!0),b?new a(this.x,this.y,this.width,this.height,this.color,this.health-1):new a(this.x,this.y,this.width,this.height,this.color,this.health)},a.initial=function(){for(var b=[],c=0;10>c;c++)for(var d=0;5>d;d++)b.push(new a(40+80*c,550-20*d,80,20));return b},a}();a.Obstacle=c;var d=function(){function a(a,b){this.name=a,this.message=b}return a}();a.Died=d;var e=function(){function a(a,b){this.name=a,this.message=b}return a}();a.GameOver=e;var f=function(){function a(a,b,c,d){this.x=a,this.y=b,this.velocityX=c,this.velocityY=d}return a.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.y),10,10)},a.anyIntersection=function(a,b){return a.lines().reduce(function(a,c){return a||b.lines().reduce(function(a,b){if(a)return a;var d=b.intersects(c);return d&&d.length&&d},!1)},!1)},a.prototype.update=function(b,c,e,f){var g=this.box();if(this.y<0)throw new d(":(");return(this.x-5<0||this.x+5>800)&&(this.velocityX=-this.velocityX),this.y+5>600&&(this.velocityY=-this.velocityY),f.reduce(function(b,c){return b||a.anyIntersection(g,c.box())},!1)&&(this.velocityY=-this.velocityY),a.anyIntersection(g,c.box())&&(this.velocityX+=3*(this.x-c.x)/80,this.velocityY*=-1),new a(this.x+this.velocityX,this.y+this.velocityY,this.velocityX,this.velocityY)},a.prototype.draw=function(a){this.box().draw(a)},a.prototype.lines=function(){return this.box().lines()},a.initial=function(){return new a(400,400,-1,-5)},a}();a.Ball=f;var g=function(){function a(a){var d=this;this.ctx=a,this.paddleKeys=[39,37],this.paddleObservable=$(document.body).onAsObservable("keyup keydown").filter(function(a){return-1!=d.paddleKeys.indexOf(a.keyCode)}).map(function(a){return"keyup"==a.type?0:a.keyCode==d.paddleKeys[0]?1:a.keyCode==d.paddleKeys[1]?-1:void 0});var g=({paddle:b.initial(),ball:f.initial(),obstacles:c.initial()},Rx.Observable.interval(1e3/30,Rx.Scheduler.requestAnimationFrame)),h=g.map(function(a){return{t:(new Date).getTime()}}).scan({date:(new Date).getTime(),dt:0,event:null},function(a,b){return{dt:(b.t-a.date)/1e3,date:b.t,event:b}}).skip(1).withLatestFrom(this.paddleObservable.startWith(0),function(a,b){return{dt:a.dt,dir:b}});h.scan({paddle:b.initial(),ball:f.initial(),obstacles:c.initial(),lives:3},function(a,b){var c=null,d=0;try{c=a.ball.update(b.dt,a.paddle,b.dir,a.obstacles)}catch(b){if(c=f.initial(),a.lives-1==0)throw new e(":(");d=-1}return{paddle:a.paddle.update(b.dt,b.dir),ball:c,obstacles:a.obstacles.map(function(b){return b.decreaseHealth(f.anyIntersection(a.ball.box(),b.box()))}).filter(function(a){return 0!=a.health}),lives:a.lives+d}}).subscribe(function(b){a.clearRect(0,0,a.canvas.width,a.canvas.height),a.fillStyle="white",b.paddle.draw(a),b.ball.draw(a),b.obstacles.forEach(function(b){return b.draw(a)})})}return a}();a.Game=g}(Breakout||(Breakout={})),$("#breakout").clickAsObservable().take(1).map(function(a){return a.target}).subscribe(function(a){{var b=a.getContext("2d");new Breakout.Game(b)}});var games;!function(a){var b=function(){function a(){}return a.getMousePos=function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}},a.indexOf=function(a,b){return a.reduce(function(a,c,d){return"number"==typeof a?a:b(c)&&d},!1)},a}();a.Utils=b;var c=function(){function a(a,b,c,d){void 0===d&&(d=[0,0]),this.rows=a,this.cols=b,this.canvas_wh=c,this.margins_tl=d,this.gridW=(c[0]-2*d[1])/b,this.gridH=(c[1]-2*d[0])/a,console.log("Grid",this.gridW,this.gridH)}return a.prototype.canvasToGrid=function(a,b){return void 0===b&&(b=null),"object"==typeof a&&a.x&&a.y&&(b=a.y,a=a.x),a-=this.margins_tl[1],b-=this.margins_tl[0],a/=this.gridW,b/=this.gridH,{x:a,y:b}},a.prototype.gridToCanvas=function(a,b){return void 0===b&&(b=null),"object"==typeof a&&"number"==typeof a.x&&"number"==typeof a.y&&(b=a.y,a=a.x),{x:this.gridW*a+this.margins_tl[1],y:this.gridH*b+this.margins_tl[0]}},a.prototype.gridToCanvasPoint=function(a,b){void 0===b&&(b=null);var c=this.gridToCanvas(a,b);return new math.Point2D(c.x,c.y)},a}();a.GridMapping=c;var d=function(a){function b(b,c,d,e,f){void 0===e&&(e=.125),void 0===f&&(f=[0,0]),a.call(this,b,c,d,f),this.border_width=e}return __extends(b,a),b.prototype.canvasToGrid=function(b,c){void 0===c&&(c=null);var d=a.prototype.canvasToGrid.call(this,b,c),e=[{o:Math.abs(d.x-Math.round(d.x)),b:"left"},{o:Math.abs(d.y-Math.round(d.y)),b:"top"}].sort(function(a,b){return a.o-b.o})[0];return e.o<this.border_width?{x:Math.floor(d.x+this.border_width),y:Math.floor(d.y+this.border_width),border:e.b}:{x:~~d.x,y:~~d.y,inGrid:!0}},b}(c);a.BorderSnapGridMapping=d;var e=function(){function a(a){this.generate=a,this.store=[]}return a.prototype.get=function(a,b){return this.store[a]||(this.store[a]=[]),this.store[a][b]||(this.store[a][b]=this.generate(a,b)),this.store[a][b]},a}();a.Grid=e}(games||(games={}));var Connected;!function(a){var b=["#629E60","#E9C03A","#B74133","#5374ED"],c=20,d=function(){function a(a,b,c){this.x=a,this.y=b,this.color=c,this.p=null}return a.prototype.down=function(b){return void 0===b&&(b=1),new a(this.x,this.y+b,this.color)},a.prototype.downWithTween=function(a){void 0===a&&(a=1);var b=this.down(a);return b.tween={from:this.tween&&this.tween.from||this,to:b},b},a.prototype.draw=function(a,c,d,e,f){void 0===d&&(d=!1),void 0===e&&(e=0),void 0===f&&(f=1),this.p=this.p||c.gridXYtoCanvas(this.x,this.y),a.beginPath();var g=c.gridSize/2;a.arc(this.p.x+g,this.p.y+g+e,g,0,2*Math.PI,!1),a.lineWidth=5,a.strokeStyle=b[this.color],a.stroke(),d&&(a.beginPath(),a.arc(this.p.x+g,this.p.y+g+e,c.gridSize/10,0,2*Math.PI,!1),a.lineWidth=5,a.strokeStyle=b[this.color],a.stroke())},a}(),e=function(){function a(a,b,c){if(this.points=a,this.turnsRemaining=b,this.dots=c,this.time=0,0==this.dots.length)for(var d=0;36>d;d++)this.dots.push(this.randomSprite(~~(d/6),d%6))}return a.prototype.randomSprite=function(a,b){return new d(a,b,~~(4*Math.random()))},a.prototype.draw=function(a,b){var d=this.time;a.clearRect(0,0,a.canvas.width,a.canvas.height),a.font="18px Arial",a.fillText(""+this.points,25,30);var e=""+(c-this.turnsRemaining)+"/"+c;a.fillText(e,a.canvas.width-a.measureText(e).width-25,30),this.dots.forEach(function(c){c.draw(a,b,!1,c.tween&&c.tween.from?(c.tween.from.y-c.y)*(1-Math.min(1,d))*b.gridSize*2:0,1)})},a.prototype.atTime=function(a){return this.time=a,this},a.prototype.clearedAnimations=function(){return new a(this.points,this.turnsRemaining,this.dots.map(function(a){return a.down(0)}))},a.prototype.addPoints=function(b){return new a(this.points+b*Math.max(1,5*~~(b/5)),this.turnsRemaining-1,this.dots)},a.bar=function(a){$("#connected-game .multiplier .bg").width(Math.min(100,a/5*33.3)+"%")},a.prototype.run=function(b){var c=this,d=b.down.take(1).flatMap(function(a){return b.dots}).takeUntil(b.up).flatMap(function(a){return Rx.Observable.from(c.dots.filter(function(b){return b.x==a.x&&b.y==a.y}))}).scan([],function(a,b){var c=a.filter(function(a){return a.x==b.x&&a.y==b.y}).length>0;if(c)return a;var d=0==a.length||(a[0].x==b.x||a[0].y==b.y)&&Math.abs(a[0].x-b.x+a[0].y-b.y)<=1,e=0==a.length||a[0].color==b.color;return d&&e?(a.unshift(b),a):[]}).tap(function(a){return a.length&&a[0].draw(b.ctx,b,!0)}).tap(function(b){return b.length&&a.bar(b.length)}).skipWhile(function(a){return 1==a.length}),e=d.publish(function(a){return a.takeUntil(a.skipWhile(function(a){return a.length>0}))});return e.lastOrDefault(null,[]).tapOnCompleted(function(){return a.bar(0)}).flatMap(function(a){return a.length?c.next(a):Rx.Observable.just(c)})},a.prototype.next=function(a){var b=this;a.forEach(function(a){b.dots.splice(b.dots.indexOf(a),1)}),this.dots=this.dots.map(function(b){var c=a.filter(function(a){return a.x==b.x&&a.y>b.y}).length;return c?b.downWithTween(c):b}),a.reduce(function(a,b){return a[b.x]=a[b.x]+1||1,a},[]).forEach(function(a,c){for(var d=1;a>=d;d++)b.dots.push(b.randomSprite(c,-d).downWithTween(a))});var c=500,d=Rx.Observable.interval(c/30,Rx.Scheduler.requestAnimationFrame).map(function(a){return a/c*1e3/30});return d.takeWhile(function(a){return 1>a}).map(function(a){return b.atTime(a)}).concat(function(){var b=this.clearedAnimations().addPoints(a.length);return b.turnsRemaining>0?Rx.Observable.just(b):Rx.Observable.just(new g(b.points)).delay(500).startWith(b)}.call(this))},a}(),f=function(a){function b(){a.call(this,0,0,[new d(2,3,0),new d(3,3,0)])}return __extends(b,a),b.prototype.draw=function(b,c){a.prototype.draw.call(this,b,c);var d="connect the two dots to start";b.font="18px Arial",b.fillText(d,b.canvas.width/2-b.measureText(d).width/2,b.canvas.height/2+100)},b.prototype.next=function(a){console.log(a.length==this.dots.length?"Advancing to normal stage":"Failed tutorial :-(");var b=a.length==this.dots.length?new e(0,c,[]):this;return Rx.Observable.just(b)},b}(e),g=function(){function a(a){this.points=a}return a.prototype.draw=function(a,b){a.clearRect(0,0,a.canvas.width,a.canvas.height);var c="You scored "+this.points+" points!";a.font="24px Arial",a.fillText(c,a.canvas.width/2-a.measureText(c).width/2,a.canvas.height/2),c="Click to restart",a.font="18px Arial",a.fillText(c,a.canvas.width/2-a.measureText(c).width/2,a.canvas.height/2+100)},a.prototype.run=function(a){return a.up.take(1).map(function(a){return new f})},a}(),h=function(){function a(a){var b=this;this.ctx=a,this.level=0,this.cols=0,this.rows=0,this.gridSize=0,this.marginTop=30,this.down=$(this.ctx.canvas).onAsObservable("mousedown"),this.up=$(window).onAsObservable("mouseup"),this.dots=$(this.ctx.canvas).onAsObservable("mousemove").filter(function(a){return 1===a.which}).map(function(a){var c=games.Utils.getMousePos(a.target,a);return b.canvasXYtoGridXY(c.x,c.y)}).distinctUntilChanged().filter(function(a){return a.inGrid&&a.x>=0&&a.x<b.cols&&a.y>=0&&a.y<b.rows}),this.cols=6,this.rows=6,this.gridSize=400/(2*this.rows+1),Rx.Observable.just(new f).flatScan(function(a){return a.draw(b.ctx,b),a.run(b).doAction(function(a){return a.draw(b.ctx,b)}).last()},function(a){return Rx.Observable.just(a)}).subscribe(function(a){return a.draw(b.ctx,b)},function(a){return console.error(a)},function(){return console.log("Completed game")})}return a.prototype.canvasXYtoGridXY=function(a,b){return a-=this.gridSize,b-=this.gridSize+this.marginTop,a/=this.gridSize,b/=this.gridSize,{x:~~(a/2),y:~~(b/2),inGrid:~~a%2==0&&~~b%2==0}},a.prototype.gridXYtoCanvas=function(a,b){return{x:this.gridSize+2*this.gridSize*a,y:this.gridSize+2*this.gridSize*b+this.marginTop}},a}();a.Game=h}(Connected||(Connected={})),Rx.Observable.just($("#connected").get(0)).take(1).subscribe(function(a){{var b=a.getContext("2d");new Connected.Game(b)}});var DotsAndBoxes;!function(a){var b=function(){function a(a,b){this.id=a,this.color=b}return a}(),c=function(a){function c(b,c,d,e){a.call(this,b,c,c),this.Owner=Rx.Observable.merge(d.map(function(a){return a.Owner})).skip(3).take(1),this.Owner.subscribe(this.draw.bind(this,e))}return __extends(c,a),c.prototype.draw=function(c,d){d instanceof b&&(c.fillStyle=d&&d.color||"blue",a.prototype.draw.call(this,c,!1,!1))},c}(math.Box),d=function(a){function c(b,c,d,e){var f=this;a.call(this,b,c),this.disposed=!1,this.resources=[],this.owned=!1,this.owner=new Rx.BehaviorSubject(null),this.Owner=this.owner.filter(function(a){return null!=a}).take(1),this.gridSize=this.size();var g=d.map(function(a){return"mousemove"==a.evt.type&&f.draw(e.ctx,a.user),"mouseout"==a.evt.type&&f.draw(e.ctx,!1),"mousedown"==a.evt.type?a.user:null}).filter(function(a){return null!=a}).subscribe(function(a){f.owned=!0,f.owner.onNext(a)});this.resources.push(g)}return __extends(c,a),c.prototype.dispose=function(){this.resources=this.resources.filter(function(a){return a.dispose()&&!1}),this.owner.dispose()},c.prototype.draw=function(a,c){this.owned||c instanceof b?a.fillStyle="gray":a.globalCompositeOperation="destination-out",this.path(a),a.fill(),a.globalCompositeOperation="source-over",this.path(a),a.strokeStyle="gray",a.stroke()},c.prototype.path=function(a){var b=this.gridSize/10;a.beginPath(),a.moveTo(this._0.x,this._0.y),this._0.y==this._1.y?(a.lineTo(this._0.x+b,this._0.y+b),a.lineTo(this._1.x-b,this._1.y+b),a.lineTo(this._1.x,this._1.y),a.lineTo(this._1.x-b,this._1.y-b),a.lineTo(this._0.x+b,this._0.y-b)):(a.lineTo(this._0.x+b,this._0.y-b),a.lineTo(this._1.x+b,this._1.y+b),a.lineTo(this._1.x,this._1.y),a.lineTo(this._1.x-b,this._1.y+b),a.lineTo(this._0.x-b,this._0.y-b)),a.lineTo(this._0.x,this._0.y)},c}(math.Line2D),e=function(){function a(a,b,e,f){if(this.points=a,this.lines=b,this.boxes=e,this.resources=[],!b.length||!e.length)for(var g=new games.Grid(function(a,c){var e=f.gridToCanvasPoint(a,c),g=f.gridToCanvasPoint(a+1,c),h=new d(e,g,f.eventsFor("top",a,c),f);return b.push(h),h}),h=new games.Grid(function(a,c){var e=f.gridToCanvasPoint(a,c+1),g=f.gridToCanvasPoint(a,c),h=new d(e,g,f.eventsFor("left",a,c),f);return b.push(h),h}),i=0,j=0,k=0;k<f.rows;i++,j=(j+1)%f.cols,k=0==j?k+1:k)e.push(new c(f.gridToCanvasPoint(j+.5,k+.5),8*f.gridSize/10,[g.get(j,k),g.get(j,k+1),h.get(j,k),h.get(j+1,k)],f.ctx));this.boxOwner=Rx.Observable.merge(e.map(function(a){return a.Owner.map(function(b){return{box:a,owner:b}})})),this.lineOwner=Rx.Observable.merge(b.map(function(a){return a.Owner.map(function(b){return{line:a,owner:b}})})),this.resources.push(this.boxOwner.subscribe(function(a){return f.score(a.owner,a.box)})),this.resources.push(this.lineOwner.subscribe(function(a){return f.linePlaced(a.owner,a.line)}))}return a.prototype.draw=function(a,b){a.clearRect(0,0,a.canvas.width,a.canvas.height),this.lines.forEach(function(b){return b.draw(a,!0)}),this.boxes.forEach(function(b){return b.draw(a,!0)})},a.prototype.run=function(a){var b=this;return Rx.Observable.using(function(){return b},function(a){return Rx.Observable.never()})},a.prototype.dispose=function(){this.resources.forEach(function(a){return a.dispose()}),this.lines.forEach(function(a){return a.dispose()})},a.start=function(b){return new a(0,[],[],b)},a}(),f=function(a){function c(c,d){var e=this;a.call(this,4,4,[c.canvas.width,c.canvas.height],1/8,[5,5]),this.ctx=c,this.players=d,this.level=0,this.user=new b("id","red"),this.users=[this.user,new b("id","blue")],this.onBox=new Rx.Subject,this.onLine=new Rx.Subject,this.initialTurn=Math.floor(Math.random()+.5),this.turns=Rx.Observable.merge(this.onLine.map(function(a){return 1}),this.onBox.window(this.onLine).flatMap(function(a){return a.count()}).filter(function(a){return a>0}).map(function(a){return 1})).scan(this.initialTurn,function(a,b){return 1-a}).startWith(this.initialTurn).tap(function(a){e.players[1-a].style.opacity="1",e.players[a].style.opacity="0"}),this.mouse=$(this.ctx.canvas).onAsObservable("mousemove mousedown mouseup").map(function(a){var b=games.Utils.getMousePos(a.target,a);return{position:e.canvasToGrid(b.x,b.y),originalEvent:null,type:a.type}}),this.hoovers=this.mouse.distinctUntilChanged(function(a){return a.position}),this.hooverInOut=this.hoovers.filter(function(a){return"mousemove"==a.type}).flatMap(function(a){return Rx.Observable.just(a).concat(e.hoovers.filter(function(b){return a.position.x!=b.position.x||a.position.y!=b.position.y||a.position.border!=b.position.border}).take(1).map(function(b){return{position:a.position,type:"mouseout",originalEvent:b.originalEvent}}))}),this.dots=Rx.Observable.merge(this.mouse.filter(function(a){return"mousedown"==a.type||"mouseup"==a.type}),this.hooverInOut),this.gridSize=this.gridW}return __extends(c,a),c.prototype.score=function(a,b){this.onBox.onNext(a)},c.prototype.linePlaced=function(a,b){this.onLine.onNext(a)},c.prototype.eventsFor=function(a,b,c){var d=this;return this.turns.map(function(e){return d.dots.filter(function(d){return d.position.border&&d.position.border==a&&d.position.x==b&&d.position.y==c}).map(function(a){return{evt:a,user:d.users[e]}})})["switch"]()},c.prototype.run=function(){var a=this;return Rx.Observable.just(e.start(this)).flatScan(function(b){return b.draw(a.ctx,a),b.run(a).doAction(function(b){return b.draw(a.ctx,a)}).last()},function(a){return Rx.Observable.just(a)}).tap(function(b){return b.draw(a.ctx,a)},function(a){return console.error(a)},function(){return console.log("Completed game")})},c}(games.BorderSnapGridMapping);a.Game=f}(DotsAndBoxes||(DotsAndBoxes={})),Reveal.forSlide(function(a){return"g-dotsandboxes"==a.currentSlide.id},function(a){var b=$("#dotsandboxes",a.currentSlide).get(0),c=$(".dots-player",a.currentSlide).get();return new DotsAndBoxes.Game(b.getContext("2d"),c).run()}).subscribe(function(a){console.log("Loaded Dots & Boxes")});var Flappy;!function(a){var b={trees:["FlappyBird/tree.png","FlappyBird/tree-high.png","FlappyBird/Junglewood_Tree.png","FlappyBird/Pearlwood_Tree.png"],clouds:["FlappyBird/cloud.png","FlappyBird/actual-cloud.png"],flappy:"FlappyBird/sprites.png",aula:"FlappyBird/aula.png",ewi:"FlappyBird/ewi-blur.png",coin:"FlappyBird/spinning_coin_gold.png"},c={},d=300,e=500,f=Math.PI/100,g=0,h=100,i=100,j=!1,k=function(){function a(a){var b=this;this.src=a,this.observable=new Rx.Subject,this.img=null,this.img=new Image,Rx.Observable.fromEvent(this.img,"load").select(function(a){return b}).multicast(this.observable).connect(),this.img.src=a}return a}(),l=function(){function a(a,b,c,d,e){void 0===e&&(e=1),this.sheet=a,this.sheet_offset=b,this.frame_width=c,this.frame_height=d,this.frame_count=e,this.f=0,this.frame_offset_x=0,this.frame_offset_y=0}return a.prototype.draw=function(a){this.drawT(a,~~((new Date).getTime()/30))},a.prototype.drawT=function(a,b){a.drawImage(this.sheet,this.sheet_offset.x+this.frame_width*(b%this.frame_count),this.sheet_offset.y,this.frame_width,this.frame_height,this.frame_offset_x,this.frame_offset_y,this.frame_width,this.frame_height)},a.prototype.lines=function(){return[]},a}(),m=function(a){function g(d,e,f){if(a.call(this,c[b.flappy],g.offset,28,14,3),this.y=d,this.rotation=e,this.velocity=f,0>=d)throw new Error("Flappy died :(")}return __extends(g,a),g.prototype.flap=function(){return new g(this.y,this.rotation,d)},g.prototype.delta=function(a){return new g(this.y+this.velocity*a,Math.max(-Math.PI/4,Math.min(Math.PI/4,this.rotation+this.velocity*f*a)),this.velocity-e*a)},g.prototype.box=function(){return new math.Box(new math.Point2D(g.x,this.y),28,14).rotate(this.rotation);

},g.prototype.draw=function(b){j&&this.box().draw(b,j),b.save(),b.translate(g.x,b.canvas.height-this.y),b.rotate(-this.rotation),b.translate(-this.frame_width/2,-this.frame_height/2),a.prototype.draw.call(this,b),b.restore()},g.initial=function(){return new g(200,0,0)},g.prototype.lines=function(){return this.box().lines()},g.offset=new math.Point2D(-3,490),g.x=60,g}(l),n=function(a){function b(){a.apply(this,arguments),this.x=400,this.y=0,this.fatal=!0}return __extends(b,a),b.prototype.boost=function(){return 0},b.prototype.draw=function(b){var c=this.box();j&&c.draw(b,j),this.x-this.width/2>b.canvas.width||this.x+this.width/2<0||(b.save(),b.translate(this.x-this.frame_width/2,b.canvas.height-c.centre.y-this.height/2),a.prototype.draw.call(this,b),b.restore())},b.prototype.at=function(a){return this.x=a,this},b.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.height/2+this.y),this.width,this.height)},b.prototype.lines=function(){return this.box().lines()},b.prototype.delta=function(a){return this.x-=h*a,this},b}(l),o=function(a){function d(){a.call(this,c[b.coin],new math.Point2D(0,0),32,32,8),this.x=400,this.width=32,this.height=32,this.y=20}return __extends(d,a),d.offset=new math.Point2D(0,0),d}(n),p=function(a){function d(d){a.call(this,null,new math.Point2D(0,0),0,0,1),this.height=d,this.width=60,this.sheet=c[b.trees[~~(Math.random()*b.trees.length)]],this.width=this.frame_width=this.sheet.width,this.height=this.frame_height=this.sheet.height}return __extends(d,a),d}(n),q=function(a){function d(){a.call(this,c[b.aula],new math.Point2D(0,0),400,300,1),this.width=this.frame_width=this.sheet.width,this.height=128,this.frame_height=this.sheet.height}return __extends(d,a),d.prototype.box=function(){return new math.Box(new math.Point2D(this.x,236),this.width,128)},d}(n),r=(function(a){function d(d){a.call(this,null,new math.Point2D(0,0),0,0,1),this.height=d,this.width=60,this.sheet=c[b.trees[~~(Math.random()*b.trees.length)]],this.width=this.frame_width=this.sheet.width,this.height=this.frame_height=this.sheet.height,this.y=g-this.height}return __extends(d,a),d}(n),function(a){function d(){a.call(this,null,new math.Point2D(0,0),0,0,1),this.sheet=c[b.clouds[~~(Math.random()*b.clouds.length)]],this.width=this.frame_width=this.sheet.width,this.height=this.frame_height=this.sheet.height,this.y=g-this.height-200*Math.random()}return __extends(d,a),d}(n)),s=function(a){function d(){a.call(this,c[b.ewi],new math.Point2D(0,0),300,500,1),this.speed=200,this.fatal=!1,this.y=0,this.width=this.frame_width,this.height=this.frame_height}return __extends(d,a),d.prototype.boost=function(){return 100},d}(n),t=function(){function a(a,b,c,d){this.points=a,this.flappy=b,this.obstacles=c,this.coins=d,this.time=0,0==this.obstacles.length&&(this.obstacles.push((new s).delta(-4)),this.obstacles.push((new q).delta(-8)),this.obstacles.push(new p(100).delta(-1)),this.obstacles.push((new r).delta(-3)),this.obstacles.push((new r).delta(-5.5)),this.obstacles.push(new p(300).delta(-11)),this.obstacles.push((new r).delta(-14)),this.obstacles.push(new p(100).delta(-11)),this.obstacles.push(new p(300).delta(-13))),0==this.coins.length&&this.coins.push((new o).at(160))}return a.prototype.draw=function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height),this.obstacles.forEach(function(b){return b.draw(a)}),this.coins.forEach(function(b){return b.draw(a)}),this.flappy.draw(a),a.font="18px Arial",a.fillText(""+this.points,25,30)},a.anyIntersection=function(a,b){return a.reduce(function(a,c){return a||b.reduce(function(a,b){if(a)return a;var d=b.intersects(c);return d&&d.length&&d},!1)},!1)},a.prototype.delta=function(b,c){var d=this.flappy.delta(b);c&&(d=d.flap());var e=this.flappy.lines(),f=this.obstacles.reduce(function(b,c){return b||c.fatal&&a.anyIntersection(c.lines(),e)},!1);if(f)throw console.log("Collision!",f),new Error("Dead by collision!");var g=this.obstacles.reduce(function(b,c){return b+(!c.fatal&&a.anyIntersection(c.lines(),[a.flappyXline])&&c.boost()||0)},0);h=g?i+g:i;var j=0,k=this.coins.map(function(a){return a.delta(b)}),l=this.coins.filter(function(b){return!a.anyIntersection(b.lines(),e)});j+=1e3*(k.length-l.length);var n=this.obstacles.map(function(a){var c=a.x,d=a.delta(b);return d.x<m.x&&c>=m.x&&(j+=a.height),d});for(n=n.filter(function(a){return a.x+a.width/2>0});this.obstacles.length>n.length;){var o=this.obstacles[this.obstacles.length-1],q=Math.max(o.x+o.width+100,400)+200*Math.random();n.push(Math.random()>.8?(new r).at(q):new p(300*Math.random()+100).at(q))}return new a(this.points+j,d,n,l)},a.prototype.run=function(a){var b=1e3,c=Rx.Observable.interval(b/30,Rx.Scheduler.requestAnimationFrame),d=Rx.Observable.merge(c.map(function(a){return{t:(new Date).getTime(),key:!1}}),a.ups.map(function(a){return{t:a,key:!0}})).scan({date:(new Date).getTime(),dt:0,event:null},function(a,b){return{dt:(b.t-a.date)/1e3,date:b.t,event:b}}).skip(1);return d.scan(this,function(a,b){return a.delta(b.dt,b.event.key)})["catch"](Rx.Observable.just(new u))},a.flappyXline=new math.Line2D(new math.Point2D(m.x,-10),new math.Point2D(m.x,g+10)),a}(),u=function(a){function b(){a.call(this,0,m.initial(),[],[])}return __extends(b,a),b.prototype.draw=function(b){a.prototype.draw.call(this,b);var c="press space to start";b.font="18px Arial",b.fillText(c,b.canvas.width/2-b.measureText(c).width/2,b.canvas.height/2+100)},b.prototype.run=function(a){return Rx.Observable.merge($(a.ctx.canvas).onAsObservable("click").map(function(a){return 1}),$(window).onAsObservable("keyup").filter(function(a){return 32==a.keyCode}).map(function(a){return 1})).take(1).map(function(a){return new t(0,m.initial(),[],[])})},b}(t),v=(function(){function a(a){this.points=a}return a.prototype.draw=function(a){a.clearRect(0,0,a.canvas.width,a.canvas.height);var b="You scored "+this.points+" points!";a.font="24px Arial",a.fillText(b,a.canvas.width/2-a.measureText(b).width/2,a.canvas.height/2),b="Click to restart",a.font="18px Arial",a.fillText(b,a.canvas.width/2-a.measureText(b).width/2,a.canvas.height/2+100)},a.prototype.run=function(a){return a.up.take(1).map(function(a){return new u})},a}(),function(){function a(a){var d=this;this.ctx=a,this.level=0,this.ups=$(window).onAsObservable("keyup").filter(function(a){return 38==a.keyCode}).map(function(a){return(new Date).getTime()}),this.down=$(this.ctx.canvas).onAsObservable("mousedown"),this.up=$(window).onAsObservable("mouseup");var e=Rx.Observable.merge(Rx.Observable.from(b.trees).flatMap(function(a){return new k(a).observable.take(1)}),Rx.Observable.from(b.clouds).flatMap(function(a){return new k(a).observable.take(1)}),new k(b.coin).observable.take(1),new k(b.flappy).observable.take(1),new k(b.ewi).observable.take(1),new k(b.aula).observable.take(1)).scan({},function(a,b){return a[b.src]=b.img,a}).last().tap(function(a){c=a});g=a.canvas.height,e.select(function(a){return new u}).flatScan(function(a){return a.draw(d.ctx),a.run(d).doAction(function(a){return a.draw(d.ctx)}).last()},function(a){return Rx.Observable.just(a)}).subscribe(function(a){return a.draw(d.ctx)},function(a){return console.error(a)},function(){return console.log("Completed game")})}return a}());a.Game=v}(Flappy||(Flappy={})),Rx.Observable.just($("#flappy").get(0)).take(1).subscribe(function(a){{var b=a.getContext("2d");new Flappy.Game(b)}});var Flow;!function(a){var b=function(){function a(a){this.flows=a}return a.simple=function(b,c,d){for(var e=b*c/d,f=[],g=[f],h=0,i=0,j=0;b*c>h;h++)h>=g.length*e&&(f=[],g.push(f)),f.push(new math.Point2D(i,j)),i+=j%2==0?1:-1,(0>i||i>=b)&&(j+=1,i=Math.min(b-1,Math.max(0,i)));return new a(g)},a.prototype.contains=function(a){return"number"==typeof this.flowIndex(a)},a.prototype.rowIndex=function(a,b){var c="number"==typeof a?this.flows[a]:a;return c.reduce(function(a,c,d){return"number"==typeof a?a:c.x==b.x&&c.y==b.y&&d},!1)},a.prototype.flowIndex=function(a){var b=this;return this.flows.reduce(function(c,d,e){return"number"==typeof c?c:"number"==typeof b.rowIndex(d,a)?e:!1},!1)},a.prototype.isStartOrEnd=function(b){var c=this.flowIndex(b);return"number"==typeof c&&c>=0&&(a.equals(b,this.flows[c][0])||a.equals(b,this.flows[c][this.flows[c].length-1]))},a.equals=function(a,b){return a.x===b.x&&a.y===b.y},a.prototype["with"]=function(b){if(null==b||"object"!=typeof b)return this;for(var c=this.flows.slice(0);c.length<=b.index;)c.push([]);return c=c.map(function(a,c){return c==b.index?b.ps:a}),new a(c)},a.prototype.permutate=function(a){if(0==a)return this;for(var b=new math.RNG(a),c=this.flows,d=100;d--;){var e=b.random()*c.length%c.length;if(c[e].length<3)break}return this},a}();a.Instance=b}(Flow||(Flow={}));var Flow;!function(a){function b(a,b,c){a.beginPath(),a.arc(c.x+b,c.y+b,b,0,2*Math.PI,!1),a.fill()}function c(a,b){a.beginPath(),a.moveTo(b._0.x,b._0.y),a.lineTo(b._1.x,b._1.y),a.stroke()}var d=["#1F00FF","#D10000","#EDEF00","#4F8000","#9FFFFF","#D57C00","#D200FF","#87302A","#65007A"],e=function(){function e(b,c){void 0===c&&(c=0),this.game=b,this.i=c,this.resources=[],console.debug("Instantiated Stage",c),this.instance=b.instance(b.cols),this.userFlows=new a.Instance([])}return e.prototype.draw=function(a,e,f){a.clearRect(0,0,a.canvas.width,a.canvas.height);for(var g=0;g<=e.cols;g++){a.beginPath();var h=e.gridToCanvasPoint(g,0),i=e.gridToCanvasPoint(g,e.rows);a.moveTo(h.x,h.y),a.lineTo(i.x,i.y),a.stroke()}for(var j=0;j<=e.rows;j++){a.beginPath();var h=e.gridToCanvasPoint(0,j),i=e.gridToCanvasPoint(e.cols,j);a.moveTo(h.x,h.y),a.lineTo(i.x,i.y),a.stroke()}a.save(),a.translate(.1*e.gridW,.1*e.gridH),this.instance.flows.forEach(function(c,f){a.fillStyle=d[f%d.length];var g=e.gridToCanvasPoint(c[0]),h=e.gridToCanvasPoint(c[c.length-1]);b(a,e.gridH/2*.8,g),b(a,e.gridH/2*.8,h)}),a.restore(),a.save(),a.translate(.5*e.gridW,.5*e.gridH),this.userFlows["with"](f).flows.forEach(function(f,g){a.strokeStyle=d[g%d.length],a.fillStyle=d[g%d.length],a.lineWidth=e.gridH/3;for(var h=1;h<f.length;h++){var i=e.gridToCanvasPoint(f[h-1]),j=e.gridToCanvasPoint(f[h]);c(a,new math.Line2D(i,j)),a.translate(-e.gridW/6,-e.gridH/6),b(a,e.gridH/2/3,j),a.translate(e.gridW/6,e.gridH/6)}}),a.restore()},e.prototype.dragSequence=function(b,c){var d=this,e=this.userFlows,f={index:this.instance.flowIndex(c),ps:[c]};e=this.userFlows["with"](f);var g=b.tiles.takeWhile(function(a){return"mousemove"==a.type}).distinctUntilChanged().takeUntil(b.tiles.filter(function(a){return"mouseup"==a.type}));return g.scan({good:!1,flow:f,uf:e},function(b,c){var e=b.flow.ps,f=games.Utils.indexOf(e,a.Instance.equals.bind(a.Instance,c));if("number"==typeof f){var g={ps:e.slice(0,f+1),index:b.flow.index};return{good:!1,flow:g,uf:b.uf["with"](g)}}if(!(b.good||!d.adjacent(e[e.length-1],c)||b.uf.contains(c)||d.instance.isStartOrEnd(c)&&d.instance.flowIndex(c)!==b.flow.index)){var g={ps:e.concat(c),index:b.flow.index},h=d.instance.isStartOrEnd(c)&&d.instance.flowIndex(c)===b.flow.index;return{good:h,flow:g,uf:b.uf["with"](g)}}return{good:b.good,flow:b.flow,uf:b.uf}})},e.prototype.run=function(a){var b=this,c=a.tiles.filter(function(a){return"mousedown"==a.type}).filter(function(a){return b.instance.isStartOrEnd(a)}).flatMap(function(c){var d=b.instance.flowIndex(c),e=b["with"](b.userFlows["with"]({ps:[],index:d}));return b.dragSequence(a,c).tap(function(c){return b.draw(a.ctx,a,c.flow)}).skipWhile(function(a){return!a.good}).last().map(function(a){return b["with"](a.uf)})["catch"](Rx.Observable.just(e))}).take(1);return c},e.prototype["with"]=function(a){var b=new e(this.game,this.i+1);return b.instance=this.instance,b.userFlows=a,b},e.prototype.adjacent=function(a,b){return a.x==b.x&&1==Math.abs(a.y-b.y)||a.y==b.y&&1==Math.abs(a.x-b.x)},e}(),f=function(a){function b(b){for(var c=[],d=1;d<arguments.length;d++)c[d-1]=arguments[d];a.call(this,b,c[0]),this.args=c}return __extends(b,a),b.prototype.draw=function(a,b){},b.prototype.run=function(a){return Rx.Observable.just(new e(a,this.args[0]))},b}(e);a.Start=f;!function(){function a(a){this.points=a}return a.prototype.draw=function(a,b){a.clearRect(0,0,a.canvas.width,a.canvas.height);var c="You scored "+this.points+" points!";a.font="24px Arial",a.fillText(c,a.canvas.width/2-a.measureText(c).width/2,a.canvas.height/2),c="Click to restart",a.font="18px Arial",a.fillText(c,a.canvas.width/2-a.measureText(c).width/2,a.canvas.height/2+100)},a.prototype.run=function(a){return Rx.Observable.just(new f(a))},a}()}(Flow||(Flow={}));var data=$.getAsObservable("Flow/flows.txt",null,"text").map(function(a){return a.data}).shareReplay(1);Reveal.forSlide(function(a){return"g-flow"==a.currentSlide.id},function(a){var b=$("#flow",a.currentSlide).get(0),c=function(a){return $(a).onAsObservable("change").map(function(a){return a.target.value}).startWith($(a).val())},d=function(a){return c(a).map(function(a){return parseInt(a)})};return Rx.Observable.combineLatest(data,d("#flow-n"),function(a,b){return{n:b,data:a}}).flatMap(function(a){console.log(a),b.height=40*a.n,b.width=40*a.n;var c=new Flow.Game(b.getContext("2d"),a.n);return c.data=a.data,c.run(new Flow.Start(c))})}).subscribe(function(a){});var Flow;!function(a){var b=function(b){function c(a,c){var d=this;void 0===c&&(c=5),b.call(this,c,c,[a.canvas.width,a.canvas.height]),this.ctx=a,this.level=0,this.data="",this.gridSize=0,this.mouse=$(this.ctx.canvas).onAsObservable("mousemove mousedown mouseup").map(function(a){var b=games.Utils.getMousePos(a.target,a);return{position:d.canvasToGrid(b.x,b.y),originalEvent:null,type:a.type}}),this.tiles=this.mouse.map(function(a){return{x:~~a.position.x,y:~~a.position.y,type:a.type}}),this.gridSize=this.gridH}return __extends(c,b),c.prototype.run=function(a){var b=this;return Rx.Observable.just(a).flatScan(function(a){return a.draw(b.ctx,b),a.run(b).doAction(function(a){return a.draw(b.ctx,b)}).last()},function(a){return Rx.Observable.just(a)}).tap(function(a){return a.draw(b.ctx,b)},function(a){return console.error(a)},function(){return console.log("Completed game")})},c.prototype.instance=function(b){if(void 0===b&&(b=4),!this.data)throw new Error("Load data first");for(var c=this.data.split(/[\s\n]/),d=[],e=0;e<c.length;e++){var f=parseInt(c[e]);isNaN(f)||(e+=2,d[f]=c.slice(e,e+f).join("\n"),e+=f-1)}var g=[];return d[b].split(/\n/g).forEach(function(a,b){a.split("").forEach(function(a,c){"."!=a&&(g[a]=g[a]||[],g[a].push(new math.Point2D(c,b)))})}),new a.Instance(Object.keys(g).map(function(a){return g[a]}))},c}(games.GridMapping);a.Game=b}(Flow||(Flow={}));var LookAndSay;!function(a){function b(a){return a.concat(Rx.Observable.just(-1)).scan([],function(a,b){return 0===a.length?[new d(b,1)]:a[0].value===b?[a[0].increase()]:[new d(b,1),a[0]]}).filter(function(a){return a.length>1}).flatMap(function(a){return Rx.Observable.just(a[1].count).concat(Rx.Observable.just(a[1].value))})}function c(){return Rx.Observable.interval(100).scan(Rx.Observable.just(1),function(a,c){return b(a).zip(Rx.Observable.interval(100),function(a,b){return a})}).startWith(Rx.Observable.just(1))}var d=function(){function a(a,b){this.value=a,this.count=b}return a.prototype.increase=function(){return new a(this.value,this.count+1)},a}();a.iteration=b,a.run=c,$("<div class='overlay' style='text-align:center; line-height: 400px'>Click to start Look and Say sequence</div>").insertAfter($("#lookandsay")).css({left:$("#lookandsay").position().left,top:$("#lookandsay").position().top,position:"absolute",zIndex:10,width:$("#lookandsay").parent().width(),height:$("#lookandsay").parent().height()}),$("#lookandsay + .overlay").one("click",function(){$(this).remove(),c().take(40).subscribe(function(a){var b=0,c=$("<li></li>");c.appendTo($("#lookandsay")),a.subscribe(function(a){c.append($("<span>"+(0!==b?", ":"")+a+"</span>")),b++})})})}(LookAndSay||(LookAndSay={}));var Minesweeper;!function(a){var b=function(a){function b(b,c,d,e){var f=this;a.call(this,b,c,c),this.ctx=e,this.neighbors=[],this.revealed=!1,this.flagged=!1,this.revealer=new Rx.BehaviorSubject(null),this.Reveal=this.revealer.filter(function(a){return null!=a}).take(1),this.is_bomb=!1,this.events=null,this.events=d,d.subscribe(function(a){3===a.originalEvent.which?f.toggleFlag():f.reveal(),f.draw(e)})}return __extends(b,a),b.prototype.toggleFlag=function(){this.revealed||(this.flagged=!this.flagged)},b.prototype.reveal=function(){return this.flagged?!0:(this.revealed||(this.revealed=!0,this.is_bomb||this.revealer.onNext(0==this.neighbors.filter(function(a){return a.is_bomb}).length)),!0)},b.prototype.initialize=function(){var a=this;this.is_bomb=Math.random()<.05,Rx.Observable.merge(this.neighbors.map(function(a){return a.Reveal})).filter(function(a){return a}).subscribe(function(b){return a.reveal()&&a.draw(a.ctx)})},b.prototype.addNeighbour=function(a){this.neighbors.push(a),a.neighbors.push(this)},b.prototype.draw=function(b){if(this.revealed){if(this.is_bomb?b.fillStyle="red":b.fillStyle="#ccc",a.prototype.draw.call(this,b,!1,!1),this.is_bomb&&this.fillText(b,String.fromCharCode(61922),"black","FontAwesome"),!this.is_bomb){var c=this.neighbors.filter(function(a){return a.is_bomb}).length;c>0&&this.fillText(b,c.toString(),"blue","Arial")}}else b.fillStyle="white",a.prototype.draw.call(this,b,!1,!1),this.flagged&&this.fillText(b,String.fromCharCode(61476),"green","FontAwesome");b.save(),b.strokeStyle="black",this.lines().forEach(function(a){b.beginPath(),b.moveTo(a._0.x,a._0.y),b.lineTo(a._1.x,a._1.y),b.stroke()}),b.restore()},b.prototype.fillText=function(a,b,c,d){a.font=this.height-4+"px "+d,a.fillStyle=c,a.fillText(b,this.centre.x-a.measureText(b).width/2,this.centre.y+this.height/2-4)},b}(math.Box),c=function(){function a(a,c,d){if(this.points=a,this.boxes=c,this.resources=[],!c.length){for(var e=new games.Grid(function(a,e){var f=new b(d.gridToCanvasPoint(a+.5,e+.5),d.gridSize,d.eventsFor("box",a,e),d.ctx);return c.push(f),f}),f=0,g=0,h=0;h<d.rows;f++,g=(g+1)%d.cols,h=0==g?h+1:h){var i=e.get(g,h);g>0&&i.addNeighbour(e.get(g-1,h)),h>0&&i.addNeighbour(e.get(g,h-1)),g>0&&h>0&&i.addNeighbour(e.get(g-1,h-1)),g>0&&h<d.rows-1&&i.addNeighbour(e.get(g-1,h+1))}for(var f=0,g=0,h=0;h<d.rows;f++,g=(g+1)%d.cols,h=0==g?h+1:h)e.get(g,h).initialize()}this.resources.push(Rx.Observable.merge(c.map(function(a){return a.events})).subscribe(function(a){return a}))}return a.prototype.draw=function(a,b){a.clearRect(0,0,a.canvas.width,a.canvas.height),this.boxes.forEach(function(b){return b.draw(a)})},a.prototype.run=function(a){var b=this;return Rx.Observable.using(function(){return b},function(a){return Rx.Observable.never()})},a.prototype.dispose=function(){this.resources.forEach(function(a){return a.dispose()})},a}(),d=function(a){function b(b){a.call(this,0,[],b)}return __extends(b,a),b.prototype.draw=function(b,c){a.prototype.draw.call(this,b,c)},b}(c),e=function(a){function b(c){var d=this;a.call(this,12,12,[c.canvas.width,c.canvas.height]),this.ctx=c,this.level=0,this.mouse=$(this.ctx.canvas).onAsObservable("mousemove mousedown mouseup").map(function(a){var c=b.getMousePos(a.target,a);return{position:d.canvasToGrid(c.x,c.y),originalEvent:a,type:a.type}}),this.dots=this.mouse.filter(function(a){return"mousedown"==a.type}),this.gridSize=this.gridW}return __extends(b,a),b.prototype.eventsFor=function(a,b,c){return this.dots.filter(function(a){return Math.floor(a.position.x)==b&&Math.floor(a.position.y)==c})},b.prototype.run=function(){var a=this;return Rx.Observable.just(new d(this)).flatScan(function(b){return b.draw(a.ctx,a),b.run(a).doAction(function(b){return b.draw(a.ctx,a)}).last()},function(a){return Rx.Observable.just(a)}).tap(function(b){return b.draw(a.ctx,a)},function(a){return console.error(a)},function(){return console.log("Completed game")})},b.getMousePos=function(a,b){var c=a.getBoundingClientRect();return{x:b.clientX-c.left,y:b.clientY-c.top}},b}(games.GridMapping);a.Game=e}(Minesweeper||(Minesweeper={})),Reveal.forSlide(function(a){return"g-minesweeper"==a.currentSlide.id},function(a){var b=$("#minesweeper",a.currentSlide).get(0);return new Minesweeper.Game(b.getContext("2d")).run()}).subscribe(function(a){console.log("Loaded Minesweeper")});var Pong;!function(a){var b=function(){function a(a,b,c){this.x=a,this.y=b,this.direction=c,this.speed=90}return a.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.y),20,60)},a.prototype.update=function(b,c){return new a(this.x,this.y+=b*c*this.speed,0)},a.prototype.draw=function(a){this.box().draw(a)},a.prototype.lines=function(){return this.box().lines()},a.initialLeft=function(){return new a(30,200,0)},a.initialRight=function(){return new a(770,200,0)},a}();a.Paddle=b;var c=function(){function a(a,b){this.name=a,this.message=b}return a}();a.LeftScore=c;var d=function(){function a(a,b){this.name=a,this.message=b}return a}();a.RightScore=d;var e=function(){function a(a,b,c,d){this.x=a,this.y=b,this.velocityX=c,this.velocityY=d}return a.prototype.box=function(){return new math.Box(new math.Point2D(this.x,this.y),20,20)},a.anyIntersection=function(a,b){return a.lines().reduce(function(a,c){return a||b.lines().reduce(function(a,b){if(a)return a;var d=b.intersects(c);return d&&d.length&&d},!1)},!1)},a.prototype.update=function(b,e,f){var g=this.box();if(this.x<0)throw new d("Score right");if(this.x>800)throw new c("Score left");return(this.y<g.height/2||this.y>400-g.height/2)&&(this.velocityY=-this.velocityY),a.anyIntersection(g,e.box())&&(this.velocityX=1.1*-this.velocityX),a.anyIntersection(g,f.box())&&(this.velocityX=1.1*-this.velocityX),new a(this.x+this.velocityX,this.y+this.velocityY,this.velocityX,this.velocityY)},a.prototype.draw=function(a){this.box().draw(a)},a.prototype.lines=function(){return this.box().lines()},a.initial=function(b){return void 0===b&&(b=1),new a(400,200,5*b,5-10*Math.random())},a}();a.Ball=e;var f=function(){function a(a){var f=this;this.ctx=a,this.leftPaddleKeys=["W".charCodeAt(0),"S".charCodeAt(0)],this.rightPaddleKeys=[38,40],this.leftPaddleObservable=$(document.body).onAsObservable("keyup keydown").filter(function(a){return-1!=f.leftPaddleKeys.indexOf(a.keyCode)}).map(function(a){return"keyup"==a.type?0:a.keyCode==f.leftPaddleKeys[0]?1:a.keyCode==f.leftPaddleKeys[1]?-1:void 0}),this.rightPaddleObservable=$(document.body).onAsObservable("keyup keydown").filter(function(a){return-1!=f.rightPaddleKeys.indexOf(a.keyCode)}).map(function(a){return"keyup"==a.type?0:a.keyCode==f.rightPaddleKeys[0]?1:a.keyCode==f.rightPaddleKeys[1]?-1:void 0}),a.fillStyle="white";var g=Rx.Observable.interval(1e3/30,Rx.Scheduler.requestAnimationFrame),h=g.map(function(a){return{t:(new Date).getTime()}}).scan({date:(new Date).getTime(),dt:0,event:null},function(a,b){return{dt:(b.t-a.date)/1e3,date:b.t,event:b}}).skip(1),i=h.withLatestFrom(this.leftPaddleObservable.startWith(0),function(a,b){return{dt:a.dt,left:b}}).withLatestFrom(this.rightPaddleObservable.startWith(0),function(a,b){return{dt:a.dt,left:a.left,right:b}}),j=i.scan({scoreLeft:0,left:b.initialLeft(),scoreRight:0,right:b.initialRight(),ball:e.initial()},function(a,b){var f=0,g=0;try{var h=a.ball.update(b.dt,a.left,a.right)}catch(b){if(b instanceof d){var h=e.initial(-1);g=1}if(b instanceof c){var h=e.initial(1);f=1}}return{scoreLeft:a.scoreLeft+f,left:a.left.update(b.dt,b.left),scoreRight:a.scoreRight+g,right:a.right.update(b.dt,b.right),ball:h}});$(a.canvas).onAsObservable("click").take(1).flatMap(function(a){return j}).subscribe(function(b){a.clearRect(0,0,a.canvas.width,a.canvas.height),b.left.draw(a),b.right.draw(a),b.ball.draw(a),a.font="50px silkscreennormal";var c=b.scoreLeft.toString(),d=b.scoreRight.toString();a.fillText(c,a.canvas.width/2-40-a.measureText(c).width,65),a.fillText(d,a.canvas.width/2+40,65)}),e.initial().draw(a)}return a}();a.Game=f}(Pong||(Pong={})),Rx.Observable.just($("#pong").get(0)).take(1).subscribe(function(a){{var b=a.getContext("2d");new Pong.Game(b)}});var diameter=15,screenW=600,screenH=450,Point2D=function(){function a(a,b){this.x=a,this.y=b,this.size=1}return a.prototype.move=function(b){return new a(this.x+b[0],this.y+b[1])},a.prototype.loopRound=function(b,c){return new a((this.x+b)%b,(this.y+c)%c)},a.prototype.equals=function(a){return this.x==a.x&&this.y==a.y},a.random=function(){return new a(~~(Math.random()*screenW/diameter),~~(Math.random()*screenH/diameter))},a.prototype.belly=function(){var b=new a(this.x,this.y);return b.size=1.4,b},a}(),State=function(){function a(a,b,c){void 0===b&&(b=null),void 0===c&&(c=0),this.snake=a,this.candy=b,this.status=c}return a.initial=function(){return new a(snakelet(~~(screenW/diameter/2),~~(screenH/diameter/2),5),[Point2D.random()])},a}(),GameState;!function(a){a[a.loaded=0]="loaded",a[a.running=1]="running",a[a.gameover=2]="gameover"}(GameState||(GameState={}));var KeyCodes;!function(a){a[a.up=38]="up",a[a.down=40]="down",a[a.left=37]="left",a[a.right=39]="right",a[a.w="W".charCodeAt(0)]="w",a[a.s="S".charCodeAt(0)]="s",a[a.a="A".charCodeAt(0)]="a",a[a.d="D".charCodeAt(0)]="d"}(KeyCodes||(KeyCodes={}));var Snake=function(){function a(){this.keyEvent=$(document.body).keydownAsObservable()}return a.prototype.start=function(a){var b=a.getContext("2d"),c=[],d=$(document.body).keydownAsObservable().filter(function(a){return 38===a.keyCode||40===a.keyCode||32===a.keyCode}).subscribe(function(a){a.preventDefault(),a.stopPropagation()});c.push(d);var e=this.keyEvent.filter(function(a){return!!KeyCodes[a.keyCode]})["do"](function(a){a.preventDefault(),a.stopPropagation()}).map(function(a){return toDirection(a.keyCode)}).distinctUntilChanged(null,function(a,b){return a[0]==b[0]||a[1]==b[1]}).filter(function(a){return 2==a.length}).startWith([]),f=this.keyEvent.filter(function(a){return 13==a.keyCode}).select(function(a){return!0}),g=new Rx.Subject,h=g.startWith(0).select(function(a){return~~(4*Math.pow(Math.random(),6))+1}).select(Monster).select(function(a){var b=Point2D.random();return a.map(function(a){return a.move([b.x,b.y])})}).select(function(a){return 1==a.length?Rx.Observable.just(a):Rx.Observable.just(a).merge(Rx.Observable.just([]).delay(4e3).selectMany(function(a){return Rx.Observable["throw"](new Error("Timeout"))}))})["switch"]().retry().replay(function(a){return a},1),i=$(window).onAsObservable("focus blur").select(function(a){return a.type}).startWith("focus").replay(function(a){return a},1),j=Rx.Observable.interval(100).withLatestFrom(i,function(a,b){return[a,b]}).filter(function(a){return"focus"==a[1]}).select(function(a){return a[0]}).withLatestFrom(e,function(a,b){return b}).withLatestFrom(h,function(a,b){return[a,b]}).scan(State.initial(),function(a,b){return eat(move(a,b[0]),b[1],g)});return c.push(g),Rx.Observable.using(function(){return new Rx.CompositeDisposable(c)},function(a){return f.startWith(!0).select(function(a){return j})["switch"]().tap(draw.bind(this,b))})},a}();Reveal.forSlide(function(a){return $(a.currentSlide).closest("#g-snake").get().length>0},function(a){console.log("Snake");var b=$("#snake").get(0);return(new Snake).start(b)}).subscribe(function(a){});var Typer;!function(a){var b=function(){function a(a){this.ctx=a,this.story=["Hello","Welcome to Typeria","a peaceful planet","in the Keymeria universe","Or at least","It WAS peaceful","We are under attack","and we need your help"]}return a.prototype.run=function(){function b(b){return g.scan(300,function(b,c){return b-c.dt*a.bulletSpeed}).takeWhile(function(a){return a>0}).map(function(a){return[b,a]})}var c=this,d=$(document.body).keydownAsObservable().filter(function(a){return"A".charCodeAt(0)<=a.keyCode&&a.keyCode<="Z".charCodeAt(0)||32===a.keyCode})["do"](function(a){return a.stopPropagation()}).scan({sentence:this.story.shift(),level:1,shoot:!1},function(a,b){var d=a.sentence,e=a.level,f=!1;return String.fromCharCode(b.keyCode)===d.substring(0,1).toUpperCase()&&(d=d.substring(1),f=!0,32===d.charCodeAt(0)&&(d=d.substring(1))),0==d.length&&(d=c.story.shift(),e+=1),{sentence:d,level:e,shoot:f}}).share(),e=d.filter(function(a){return a.shoot}).map(function(a){return 1}),f=Rx.Observable.interval(1e3/30,Rx.Scheduler.requestAnimationFrame),g=f.map(function(a){return{t:(new Date).getTime()}}).scan({date:(new Date).getTime(),dt:0,event:null},function(a,b){return{dt:(b.t-a.date)/1e3,date:b.t,event:b}}).skip(1).share(),h=e.map(function(a,c){return b(c)}).mergeAll(),i=g.withLatestFrom(h.buffer(g),function(a,b){return{dt:a.dt,bullets:b}}).scan({shipPostion:0,bullets:[],lastHit:-1},function(b,c){var d=c.bullets.filter(function(a){return a[1]<b.shipPostion&&b.lastHit<a[0]}).length,e=c.bullets.filter(function(a){return a[1]>b.shipPostion});return{shipPostion:b.shipPostion+c.dt*a.shipSpeed-d*a.shootBack,bullets:e,lastHit:b.lastHit+d}}).takeWhile(function(a){return a.shipPostion<300});return i.withLatestFrom(d,function(a,b){return{state:b,shipBullets:a}}).tap(function(a){var b=a.state,d=c.ctx;d.clearRect(0,0,d.canvas.width,d.canvas.height),d.fillStyle="black";var e=new math.Box(new math.Point2D(150,a.shipBullets.shipPostion-30),20,60);e.draw(d,!1,!1),a.shipBullets.bullets.forEach(function(a){var b=new math.Box(new math.Point2D(150,a[1]),5,5);b.draw(d,!1,!1)}),d.beginPath(),d.moveTo(0,300),d.lineTo(d.canvas.width,300),d.stroke(),d.font="20px silkscreennormal";var f=b.sentence;c.ctx.fillText(f,c.ctx.canvas.width/2-c.ctx.measureText(f).width/2,355)})},a.shipSpeed=37,a.bulletSpeed=100,a.shootBack=6,a}();a.Game=b}(Typer||(Typer={})),Reveal.forSlide(function(a){return"g-typer"==a.currentSlide.id},function(a){var b=$("#typer",a.currentSlide).get(0);return new Typer.Game(b.getContext("2d")).run()}).subscribe(function(a){console.log("Loaded Typer")});